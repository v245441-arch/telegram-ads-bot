#!/usr/bin/env python3
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –æ –∂–∞–ª–æ–±–∞—Ö.
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è add_complaint —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.
"""

import asyncio
import sys
import os

# –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –ø—É—Ç—å –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
sys.path.append('.')

async def test_complaint_notification():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é add_complaint –∏ –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É."""
    try:
        # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–æ–¥—É–ª–∏
        from bot import add_complaint, init_db, add_ad_to_db, bot, ADMIN_ID
        import sqlite3
        
        print("üß™ –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∂–∞–ª–æ–±–∞—Ö...")
        
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ë–î
        init_db()
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
        conn = sqlite3.connect('ads.db')
        cursor = conn.cursor()
        cursor.execute('SELECT COUNT(*) FROM ads')
        ads_count = cursor.fetchone()[0]
        
        if ads_count == 0:
            print('üìù –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ...')
            # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
            ad_id = add_ad_to_db(
                title='–¢–µ—Å—Ç–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∂–∞–ª–æ–±',
                description='–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∏—Å—Ç–µ–º—ã –∂–∞–ª–æ–± –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞',
                price=1500,
                category='üì± –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞',
                photo_id=None,
                user_id=123456,
                username='testuser'
            )
            print(f'‚úÖ –¢–µ—Å—Ç–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ, ID: {ad_id}')
        else:
            cursor.execute('SELECT id, title FROM ads LIMIT 1')
            ad = cursor.fetchone()
            ad_id = ad[0]
            print(f'üìä –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ: ID={ad_id}, –ù–∞–∑–≤–∞–Ω–∏–µ={ad[1]}')
        
        conn.close()
        
        print(f'\nüß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é add_complaint...')
        print(f'üìå ID –æ–±—ä—è–≤–ª–µ–Ω–∏—è: {ad_id}')
        print(f'üë§ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: 789012')
        print(f'üìù –ü—Ä–∏—á–∏–Ω–∞: üö´ –¢–µ—Å—Ç–æ–≤–∞—è –∂–∞–ª–æ–±–∞ –Ω–∞ —Å–ø–∞–º')
        
        try:
            # –¢–µ—Å—Ç–∏—Ä—É–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é add_complaint
            complaint_id = await add_complaint(ad_id, 789012, 'üö´ –¢–µ—Å—Ç–æ–≤–∞—è –∂–∞–ª–æ–±–∞ –Ω–∞ —Å–ø–∞–º')
            print(f'‚úÖ –§—É–Ω–∫—Ü–∏—è add_complaint –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ')
            print(f'üìä ID —Å–æ–∑–¥–∞–Ω–Ω–æ–π –∂–∞–ª–æ–±—ã: {complaint_id}')
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∂–∞–ª–æ–±–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –±–∞–∑—É
            conn = sqlite3.connect('ads.db')
            cursor = conn.cursor()
            cursor.execute('SELECT * FROM complaints WHERE id = ?', (complaint_id,))
            complaint_data = cursor.fetchone()
            conn.close()
            
            if complaint_data:
                print(f'‚úÖ –ñ–∞–ª–æ–±–∞ #{complaint_id} —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö')
                print(f'üìã –î–∞–Ω–Ω—ã–µ –∂–∞–ª–æ–±—ã:')
                print(f'   - ID: {complaint_data[0]}')
                print(f'   - ID –æ–±—ä—è–≤–ª–µ–Ω–∏—è: {complaint_data[1]}')
                print(f'   - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {complaint_data[2]}')
                print(f'   - –ü—Ä–∏—á–∏–Ω–∞: {complaint_data[3]}')
                print(f'   - –°—Ç–∞—Ç—É—Å: {complaint_data[5]}')
            else:
                print(f'‚ùå –ñ–∞–ª–æ–±–∞ #{complaint_id} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö')
            
            print(f'\nüì® –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É:')
            print(f'   - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä ID: {ADMIN_ID}')
            print(f'   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å:')
            print(f'     ‚Ä¢ –ó–∞–≥–æ–ª–æ–≤–æ–∫ "‚ö†Ô∏è –ù–æ–≤–∞—è –∂–∞–ª–æ–±–∞"')
            print(f'     ‚Ä¢ ID –∂–∞–ª–æ–±—ã #{complaint_id}')
            print(f'     ‚Ä¢ ID –æ–±—ä—è–≤–ª–µ–Ω–∏—è #{ad_id}')
            print(f'     ‚Ä¢ –ü—Ä–∏—á–∏–Ω—É –∂–∞–ª–æ–±—ã')
            print(f'     ‚Ä¢ Inline-–∫–Ω–æ–ø–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–∞')
            
            print(f'\n‚úÖ –¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ!')
            print(f'üìã –§—É–Ω–∫—Ü–∏—è add_complaint —Ç–µ–ø–µ—Ä—å:')
            print(f'   1. –î–æ–±–∞–≤–ª—è–µ—Ç –∂–∞–ª–æ–±—É –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö')
            print(f'   2. –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ JOIN')
            print(f'   3. –§–æ—Ä–º–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞')
            print(f'   4. –°–æ–∑–¥–∞–µ—Ç inline-–∫–Ω–æ–ø–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–∞:')
            print(f'      - ‚úÖ –ü–æ–º–µ—Ç–∏—Ç—å —Ä–µ—à—ë–Ω–Ω–æ–π')
            print(f'      - ‚ùå –£–¥–∞–ª–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ')
            print(f'      - ‚è≥ –û—Å—Ç–∞–≤–∏—Ç—å')
            print(f'   5. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É (ID: {ADMIN_ID})')
            
            return True
            
        except Exception as e:
            print(f'‚ùå –û—à–∏–±–∫–∞ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ add_complaint: {e}')
            import traceback
            traceback.print_exc()
            return False
        
    except Exception as e:
        print(f'‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ/—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: {e}')
        import traceback
        traceback.print_exc()
        return False

if __name__ == '__main__':
    # –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç
    success = asyncio.run(test_complaint_notification())
    
    if success:
        print('\nüéâ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!')
        print('–°–∏—Å—Ç–µ–º–∞ –∂–∞–ª–æ–± —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.')
    else:
        print('\n‚ùå –¢–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ–π–¥–µ–Ω—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—à–∏–±–∫–∏ –≤—ã—à–µ.')
    
    print('\nüìù –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –±–æ—Ç–µ:')
    print('1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: python3 bot.py')
    print('2. –ù–∞–π–¥–∏—Ç–µ –ª—é–±–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ')
    print('3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "‚ö†Ô∏è –ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è"')
    print('4. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –∂–∞–ª–æ–±—ã')
    print('5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ–ª—É—á–∏–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å inline-–∫–Ω–æ–ø–∫–∞–º–∏')